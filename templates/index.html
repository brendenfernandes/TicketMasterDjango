<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketmaster Event Finder</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        body.dark-mode {
            background-color: #121212 !important;
            color: #e4e4e4 !important;
        }
        body.dark-mode section.hero {
            background-color: #000 !important;
            color: #fff !important;
        }
        body.dark-mode .card {
            background-color: #1f1f1f !important;
            color: #f0f0f0 !important;
        }
        body.dark-mode .results-box {
            background-color: #1a1a1a !important;
            color: #f0f0f0 !important;
        }
        body.dark-mode .btn-outline-primary {
            color: #9ecbff !important;
            border-color: #9ecbff !important;
        }
        body.dark-mode .btn-outline-primary:hover {
            background-color: #9ecbff !important;
            color: #000 !important;
        }
        body.dark-mode .btn-primary {
            background-color: #4a90e2 !important;
            border-color: #4a90e2 !important;
        }
        body.dark-mode .btn-warning {
            background-color: #d8a300 !important;
            border-color: #d8a300 !important;
            color: #000 !important;
        }
        body.dark-mode .btn-outline-secondary {
            color: #ddd !important;
            border-color: #888 !important;
        }
    </style>
</head>

<body class="bg-light text-dark">

<section class="hero bg-dark text-white text-center py-5">
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-lg-8 col-md-10">

                <h1 class="fw-light mb-2">Ticketmaster</h1>
                <h4 class="fw-bold mb-4">Quickly find tickets around you</h4>

                <button id="darkModeToggle" class="btn btn-outline-secondary mb-4">
                    Toggle Dark Mode
                </button>

                <form class="mx-auto mb-3">
                    <div class="row g-0 justify-content-center align-items-center">
                        <div class="col-md-5">
                            <input list="classifications" id="classification" name="classification"
                                   class="form-control rounded-0 rounded-start" placeholder="Select classification">
                            <datalist id="classifications">
                                <option value="Music">
                                <option value="Sports">
                                <option value="Theater">
                                <option value="Family">
                                <option value="Arts & Theater">
                                <option value="Concerts">
                                <option value="Comedy">
                                <option value="Dance">
                            </datalist>
                        </div>

                        <div class="col-md-5">
                            <input list="cities" id="city" name="city"
                                   class="form-control rounded-0" placeholder="Enter city">
                            <datalist id="cities">
                                <option value="New York">
                                <option value="Los Angeles">
                                <option value="Chicago">
                                <option value="Houston">
                                <option value="San Francisco">
                                <option value="Miami">
                                <option value="Nashville">
                            </datalist>
                        </div>

                        <div class="col-md-2">
                            <button type="submit" class="btn btn-primary w-100 rounded-0 rounded-end">Search</button>
                        </div>
                    </div>
                </form>

                {% if error %}
                <div class="alert alert-danger text-center mt-3">{{ error }}</div>
                {% endif %}

                <div class="mt-3">
                    <a href="{% url 'favorites' %}" class="btn btn-warning">View Favorites</a>
                </div>

            </div>
        </div>
    </div>
</section>

{% if events %}
<section id="resultsSection" class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-10 shadow p-4 rounded-3 results-box">

            <div class="text-center mb-4">
                <h4>Event Results</h4>
            </div>

            <div class="row row-cols-1 g-4 justify-content-center">
                {% for event in events %}
                    <div class="col-12 mb-4">
                        <div class="card shadow-sm border-0 overflow-hidden">

                            <div class="row g-0 align-items-center">
                                <div class="col-12 col-md-5">
                                    <img src="{{ event.image }}" class="img-fluid w-100 rounded-top rounded-md-start"
                                         alt="{{ event.name }}" style="object-fit:cover; height:100%;">
                                </div>

                                <div class="col-12 col-md-4 d-flex flex-column justify-content-center p-3">
                                    <h5 class="card-title fs-5 fw-semibold">{{ event.name }}</h5>
                                    <p class="card-text fs-5 mb-1">{{ event.venue }}</p>
                                    <p class="card-text mb-1">
                                        <i class="bi bi-geo-alt-fill me-1"></i> {{ event.address }}
                                    </p>
                                    <p class="card-text mb-1">{{ event.city }}, {{ event.state }}</p>
                                </div>

                                <div class="col-12 col-md-3 d-flex flex-column justify-content-center align-items-md-end align-items-start p-3">
                                    <div class="fs-5 mb-1">{{ event.day }} {{ event.date }}</div>
                                    <div class="fs-5 mb-2">{{ event.time }}</div>

                                    <a href="{{ event.url }}" target="_blank" class="btn btn-outline-primary btn-sm mb-2">
                                        <i class="bi bi-ticket-detailed"></i> Find Tickets
                                    </a>

                                    {% if event.id in favorites %}
                                        <form method="post" action="{% url 'remove_favorite' event.id %}">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-danger btn-sm">Unfavorite</button>
                                        </form>
                                    {% else %}
                                        <form method="post" action="{% url 'add_favorite' %}">
                                            {% csrf_token %}
                                            <input type="hidden" name="event_id" value="{{ event.id }}">
                                            <input type="hidden" name="name" value="{{ event.name }}">
                                            <input type="hidden" name="image" value="{{ event.image }}">
                                            <input type="hidden" name="url" value="{{ event.url }}">
                                            <input type="hidden" name="venue" value="{{ event.venue }}">
                                            <input type="hidden" name="address" value="{{ event.address }}">
                                            <input type="hidden" name="city" value="{{ event.city }}">
                                            <input type="hidden" name="state" value="{{ event.state }}">
                                            <input type="hidden" name="day" value="{{ event.day }}">
                                            <input type="hidden" name="date" value="{{ event.date }}">
                                            <input type="hidden" name="time" value="{{ event.time }}">
                                            <button type="submit" class="btn btn-success btn-sm">Add to Favorites</button>
                                        </form>
                                    {% endif %}
                                </div>

                            </div>

                        </div>
                    </div>
                {% endfor %}
            </div>

        </div>
    </div>
</section>
{% endif %}

<script>
    document.getElementById("darkModeToggle").addEventListener("click", () => {
        document.body.classList.toggle("dark-mode");
    });
</script>

</body>
</html>
